<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Skull Code Rain</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: black;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <canvas id="bg"></canvas>

    <script type="module">
      import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
      import { GLTFLoader } from "https://unpkg.com/three@0.160.0/examples/jsm/loaders/GLTFLoader.js";

      // --- Configuraci칩n base ---
      const matrixChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*';
      const chars = matrixChars.split('');

      const canvas = document.getElementById('bg');
      const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 0, 8);

      // --- Luces ---
      const ambientLight = new THREE.AmbientLight(0x00ff99, 0.3);
      const warmLight = new THREE.PointLight(0xffffff, 1.2);
      warmLight.position.set(3, 6, 5);
      scene.add(ambientLight, warmLight);

      // --- Cargar cr치neo realista ---
      let skull = null;
      const loader = new GLTFLoader();
      loader.load(
        'https://raw.githubusercontent.com/pmndrs/drei-assets/main/skull.glb',
        gltf => {
          skull = gltf.scene;
          skull.scale.set(2, 2, 2);
          skull.position.set(0, -0.2, 0);
          skull.traverse(o => {
            if (o.isMesh) {
              o.material.roughness = 1;
              o.material.metalness = 0;
              o.material.color = new THREE.Color(0xf5f5dc); // tono hueso
            }
          });
          scene.add(skull);
        },
        undefined,
        err => console.error('Error cargando el cr치neo:', err)
      );

      // --- Letras ---
      const dropsCount = 450;
      const drops = [];
      for (let i = 0; i < dropsCount; i++) {
        drops.push({
          x: (Math.random() - 0.5) * 20,
          y: Math.random() * 12 - 6,
          z: (Math.random() - 0.5) * 10,
          char: chars[Math.floor(Math.random() * chars.length)],
          speed: 0.02 + Math.random() * 0.04,
        });
      }

      // --- Canvas 2D para letras ---
      const letterCanvas = document.createElement('canvas');
      letterCanvas.width = window.innerWidth;
      letterCanvas.height = window.innerHeight;
      const ctx = letterCanvas.getContext('2d');
      document.body.appendChild(letterCanvas);
      letterCanvas.style.position = 'absolute';
      letterCanvas.style.top = 0;
      letterCanvas.style.left = 0;
      letterCanvas.style.pointerEvents = 'none';

      // --- Movimiento del mouse ---
      let mouseX = 0, mouseY = 0;
      window.addEventListener('mousemove', e => {
        mouseX = (e.clientX / window.innerWidth - 0.5) * Math.PI;
        mouseY = (e.clientY / window.innerHeight - 0.5) * Math.PI / 2;
      });

      // --- Animaci칩n ---
      function animate() {
        requestAnimationFrame(animate);

        if (skull) {
          skull.rotation.y += (mouseX - skull.rotation.y) * 0.05;
          skull.rotation.x += (mouseY - skull.rotation.x) * 0.05;
        }

        ctx.clearRect(0, 0, letterCanvas.width, letterCanvas.height);
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#00ff00';

        drops.forEach(d => {
          d.y -= d.speed;
          if (d.y < -6) {
            d.y = 6;
            d.x = (Math.random() - 0.5) * 20;
            d.char = chars[Math.floor(Math.random() * chars.length)];
          }

          const pos = new THREE.Vector3(d.x, d.y, d.z);
          pos.project(camera);
          const px = (pos.x * 0.5 + 0.5) * window.innerWidth;
          const py = (-pos.y * 0.5 + 0.5) * window.innerHeight;

          ctx.fillStyle = '#0F0';
          ctx.font = '18px monospace';
          ctx.fillText(d.char, px, py);
        });

        renderer.render(scene, camera);
      }
      animate();

      window.addEventListener('resize', () => {
        renderer.setSize(window.innerWidth, window.innerHeight);
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        letterCanvas.width = window.innerWidth;
        letterCanvas.height = window.innerHeight;
      });
    </script>
  </body>
</html>
