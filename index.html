<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Matrix Skull 3D</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: black;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <canvas id="bg"></canvas>

    <!-- Librerías -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/loaders/GLTFLoader.js"></script>

    <script>
      // --- Configuración base ---
      const matrixChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*';
      const chars = matrixChars.split('');

      const canvas = document.getElementById('bg');
      const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 0, 8);

      // Luz
      scene.add(new THREE.AmbientLight(0xffffff, 0.7));
      const dirLight = new THREE.DirectionalLight(0xffffff, 1);
      dirLight.position.set(10, 10, 10);
      scene.add(dirLight);

      // --- Cargar modelo cráneo ---
      let skull = null;
      const loader = new THREE.GLTFLoader();
      loader.load(
        'https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/BrainStem/glTF/BrainStem.gltf',
        gltf => {
          skull = gltf.scene;
          skull.scale.set(0.02, 0.02, 0.02);
          scene.add(skull);
        },
        undefined,
        err => console.error('Error cargando cráneo:', err)
      );

      // --- Letras ---
      const dropsCount = 400;
      const drops = [];
      for (let i = 0; i < dropsCount; i++) {
        drops.push({
          x: (Math.random() - 0.5) * 20,
          y: Math.random() * 12 - 6,
          z: (Math.random() - 0.5) * 10,
          char: chars[Math.floor(Math.random() * chars.length)],
          speed: 0.03 + Math.random() * 0.05,
        });
      }

      // --- Canvas 2D para letras ---
      const letterCanvas = document.createElement('canvas');
      letterCanvas.width = window.innerWidth;
      letterCanvas.height = window.innerHeight;
      const ctx = letterCanvas.getContext('2d');
      document.body.appendChild(letterCanvas);
      letterCanvas.style.position = 'absolute';
      letterCanvas.style.top = 0;
      letterCanvas.style.left = 0;
      letterCanvas.style.pointerEvents = 'none';

      // --- Movimiento mouse ---
      let mouseX = 0, mouseY = 0;
      window.addEventListener('mousemove', e => {
        mouseX = (e.clientX / window.innerWidth - 0.5) * Math.PI;
        mouseY = (e.clientY / window.innerHeight - 0.5) * Math.PI / 2;
      });

      // --- Animación ---
      function animate() {
        requestAnimationFrame(animate);

        if (skull) {
          skull.rotation.y += (mouseX - skull.rotation.y) * 0.05;
          skull.rotation.x += (mouseY - skull.rotation.x) * 0.05;
        }

        ctx.clearRect(0, 0, letterCanvas.width, letterCanvas.height);

        drops.forEach(d => {
          d.y -= d.speed;
          if (d.y < -6) {
            d.y = 6;
            d.x = (Math.random() - 0.5) * 20;
            d.char = chars[Math.floor(Math.random() * chars.length)];
          }

          const pos = new THREE.Vector3(d.x, d.y, d.z);
          pos.project(camera);
          const px = (pos.x * 0.5 + 0.5) * window.innerWidth;
          const py = (-pos.y * 0.5 + 0.5) * window.innerHeight;

          ctx.fillStyle = '#0F0';
          ctx.font = '16px monospace';
          ctx.fillText(d.char, px, py);
        });

        renderer.render(scene, camera);
      }
      animate();

      window.addEventListener('resize', () => {
        renderer.setSize(window.innerWidth, window.innerHeight);
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        letterCanvas.width = window.innerWidth;
        letterCanvas.height = window.innerHeight;
      });
    </script>
  </body>
</html>
